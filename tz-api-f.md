## ТЗ по интеграции публичного API во фронтенд sro-frontend (по страницам)

Цель: сохранить текущую визуальную структуру и UX всех страниц sro-frontend, заменив мок-данные на реальные данные из sro-backend. Для каждого этапа указаны источники данных (эндпоинты), параметры запросов, сопоставление полей и задачи реализации.

ВАЖНО (общая подготовка):
- Настроить переменные окружения для фронта: `NEXT_PUBLIC_API_URL` (базовый URL API), `NEXT_PUBLIC_FILES_BASE_URL` (если раздача файлов отдельным доменом).
- Включить CORS на бэке для домена фронта (origin sro-frontend).
- Гарантировать публичную раздачу загруженных файлов `uploads/documents` и т.п. (на уровне Nest/NGINX). Ссылки должны быть абсолютными или корректно дополняться на фронте.
- Использовать унифицированный клиент на фронте: ожидать формат ответов `{ success: boolean, data: T, message?: string, pagination?: {...} }`.
- Проверить и при необходимости прогнать сиды (`sro-backend/scripts/seed-data.ts`) для категорий, типов и базовых страниц.

---

### Глобальный этап 0: Инфраструктура фронта
- [x] Создать `src/lib/api.ts` (или аналог) с `fetchJson<T>(path, params)` и обработкой `ApiResponse<T>`.
- Создать набор сервисов: `newsService`, `eventsService`, `documentsService`, `registryService`, `pagesService` (slug-based), `settingsService`, `compensationFundService`.
- Добавить базовые хелперы маппинга для приведения бэкенд-сущностей к фронт-типам (`src/types/index.ts`): даты → строки ISO, вложенные объект-id → строки/объекты, поля SEO.

- [x] Прогресс: реализован `eventsService` (фронт), подключение к API выполнено

---

### Этап 1: Главная страница `/`
- Текущие секции: Hero, QuickLinks, AboutPreview, NewsSection, AssociationInfo, FAQ.
- Источники данных:
  - Новости: `GET /news/latest?limit=3` или `GET /news/public?limit=3` (для блока «последнее»).
  - Мероприятия (опционально для превью): `GET /events/upcoming?limit=3`.
  - Статистика реестра: `GET /registry/statistics` (для числовых показателей, если нужны).
  - Настройки сайта (для текста о компании): `GET /settings`.
- Задачи:
  1) Добавить загрузку данных параллельно (новости, мероприятия, настройки, статистика). — ВЫПОЛНЕНО
  2) Пробросить данные в компоненты NewsSection/AssociationInfo. — ВЫПОЛНЕНО
  3) Сохранить текущий макет; при отсутствии данных показывать skeleton/empty state. — ВЫПОЛНЕНО

---

### Этап 2: Новости `/news`
- Сейчас: статический список и категории.
- Источники данных:
  - Категории: `GET /news/categories`.
  - Список: `GET /news?status=published&category={slug?}&search={q?}&page={n}&limit={n}&sortBy=publishedAt&sortOrder=desc`.
  - Альтернатива (строго публичные): `GET /news/public?category={slug?}&limit={n}` (без пагинации).
- Маппинг полей:
  - `title, content, excerpt, publishedAt, updatedAt, tags, featured, cover, views, status` → 1:1.
  - `author` на бэке — это ObjectId; фронту нужен строковый автор. Если сервис возвращает популяцию ФИО/имя — отобразить, иначе вывести «Администрация СРО» по умолчанию.
- Задачи:
  1) Подключить загрузку категорий и новостей с учетом фильтров (поиск, категория, теги, пагинация). — ВЫПОЛНЕНО
  2) Поддержать пагинацию из `ResponseUtil.paginated` (читать `pagination`). — ВЫПОЛНЕНО
  3) Сохранить карточки и лэйаут; в «Рекомендуемые» использовать `GET /news/featured?limit=...` (опционально). — ВЫПОЛНЕНО

ВАЖНО: Убедиться, что категории новостей засеяны (slugs: `legislation`, `events`, `registry`, `reports`, `compensation-fund`, `announcements`). При отсутствии — добавить сиды через админку или `seed-data.ts`.

---

### Этап 3: Новости — детальная `/news/[id]`
- Источник данных: `GET /news/:id`.
- Похожие новости: `GET /news/category/{categorySlug}?limit=3` (если в новости присутствует категория и slug).
- Задачи:
  1) Заменить локальный поиск по мок-данным на загрузку через API. — ВЫПОЛНЕНО
  2) Похожие — подгружать по категории (исключая текущую). — ВЫПОЛНЕНО
  3) Поддержать share/print как сейчас; счетчик views менять не требуется (на бэке публичного инкремента нет). — ВЫПОЛНЕНО

---

### Этап 4: Мероприятия `/events`
- Источники данных:
  - Список: `GET /events?search={q?}&type={slug?}&status={draft|published|...}&location={?}&featured={?}&registrationRequired={?}&startDateFrom={ISO?}&startDateTo={ISO?}&page={n}&limit={n}&sortBy=startDate&sortOrder=desc` (см. EventQueryDto).
  - Типы: `GET /events/types` (для фильтра по типу и отображения).
  - Избранные: `GET /events/featured?limit=...` (опционально).
  - Календарь: `GET /events/calendar?...` (если потребуется для календарного вида).
- Маппинг полей: все 1:1, включая `agenda`, `organizer`, `contactEmail/Phone`, `price`, `requirements`, `tags`.
- Задачи:
  1) Подключить загрузку типов и списка по фильтрам; синхронизировать фильтры UI с параметрами EventQueryDto. — ВЫПОЛНЕНО
  2) Поддержать переключение «Список/Календарь»: для календаря использовать либо тот же список, либо `GET /events/calendar`. — ВЫПОЛНЕНО
  3) Пагинация на основе `pagination`. — ВЫПОЛНЕНО

ВАЖНО: Убедиться, что типы мероприятий засеяны (`slug`: `seminar`, `conference`, `training`, `meeting`) с цветами — иначе заполнить через админку/seed.

---

### Этап 5: Мероприятие — детальная `/events/[id]`
- Источник данных: `GET /events/:id`.
- Связанные мероприятия (того же типа): загрузить все и отфильтровать по `type` или добавить запросом `GET /events?type={slug}&limit=3`.
- Регистрация (при необходимости): `POST /events/:id/register` (публичный). Тело соответствует `RegisterEventDto`.
- Задачи:
  1) Подгружать событие, отображать секции как в макете (agenda, контакты, цена и пр.). — ВЫПОЛНЕНО
  2) Кнопки «Поделиться», «В календарь», «Регистрация» — оставить; регистрацию связать с API. — ВЫПОЛНЕНО

---

### Этап 6: Реестр членов `/registry`
- Источники данных:
  - Поиск и список: `GET /registry?search={q?}&region={?}&status={active|excluded|suspended}&page={n}&limit={n}&sortBy={...}&sortOrder=asc|desc` (см. RegistryQueryDto).
  - Статистика: `GET /registry/statistics`.
  - Экспорт: `GET /registry/export/excel` | `GET /registry/export/csv`.
- Маппинг полей: фронт-тип `ArbitraryManager` содержит строки; на бэке даты и вложенные структуры — привести к строкам. Необязательные поля не ломают вёрстку.
- Задачи:
  1) Подключить список с фильтрами формы (ФИО→search, ИНН→search по точному совпадению не поддерживается — см. ВАЖНО ниже, регион, статус). Для ИНН желательно отдельное поле. — ВЫПОЛНЕНО
  2) Пагинация из `pagination`. — ВЫПОЛНЕНО
  3) Кнопку «Экспорт» перевести на вызов бэка (excel/csv), либо оставить локальный CSV как fallback. — ВЫПОЛНЕНО (пока fallback CSV; экспорт через API добавлен в сервис)

ВАЖНО: Для быстрого поиска ИНН и номера реестра можно использовать `GET /registry/inn/:inn` и `GET /registry/number/:registryNumber` — предусмотреть отдельные поля или автодетект.

---

### Этап 7: Реестр — детальная `/registry/[id]`
- Источник данных: `GET /registry/:id`.
- Отображение всех блоков (личные данные, контакты, статус, образование, страхование, взносы, проверки, дисциплина и пр.) — поля уже предусмотрены в схеме.
- Задачи:
  1) Подгружать участника по `id`, приводить даты в читабельный формат, сохранить текущую раскладку блоков. — ВЫПОЛНЕНО
  2) Быстрые действия (звонок, email, печать) оставить без изменений. — ВЫПОЛНЕНО

---

### Этап 8: Документы — раздел `/documents` (хаб)
- Сейчас: статический хаб с ссылками.
- Источники данных (для счётчиков/актуальности — опционально):
  - Публичные документы: `GET /documents/public?category={...}&page={...}&limit={...}`.
  - Категории: `GET /documents/categories`.
- Задачи:
  1) На первом шаге оставить статический хаб (как сейчас), опционально добавить динамические счётчики из API. — ВЫПОЛНЕНО
  2) Ссылки ведут на страницы категорий: `/documents/regulatory`, `/documents/rules` и т.д. — ВЫПОЛНЕНО

---

### Этап 9: Документы — Нормативные `/documents/regulatory`
- Источник данных: `GET /documents/public?category=regulatory&page={n}&limit={n}&sortBy=uploadedAt&sortOrder=desc`.
- Файловые операции:
  - Просмотр: `GET /documents/:id/preview` (inline, доступно только если `isPublic=true`).
  - Скачивание: `GET /documents/:id/download` (проверяется `isPublic`).
- Задачи:
  1) Заменить статический список на данные API, оставить выбранный режим «категории/список» как переключение представлений. — ВЫПОЛНЕНО
  2) Кнопки «Скачать», «Печать», «Предпросмотр» привязать к соответствующим эндпоинтам. — ВЫПОЛНЕНО

---

### Этап 10: Документы — Правила `/documents/rules`
- Источник данных: `GET /documents/public?category=rules&page={n}&limit={n}`.
- Задачи:
  1) Аналогично нормативным документам, отрисовать листинг из API. — ВЫПОЛНЕНО
  2) Секция «Содержание документов» может остаться статической (если нет структуированных разделов в БД). При появлении структур — вывести из `metadata`/доп. полей. — ВЫПОЛНЕНО

---

### Этап 11: Компенсационный фонд `/compensation-fund`
- Источники данных:
  - Инфо о фонде: `GET /compensation-fund` (сумма, валюта, дата обновления, банковские реквизиты, связанные документы).
  - История: `GET /compensation-fund/recent?limit=...` или `GET /compensation-fund/history?page=...&limit=...`.
  - Документы фонда — по id из массива `documents` (через `/documents/:id` + preview/download).
- Задачи:
  1) Подставить сумму фонда и дату обновления в карточки, реквизиты — в блок «Реквизиты». — ВЫПОЛНЕНО
  2) Таблицу «История изменений фонда» заполнить данными истории. — ВЫПОЛНЕНО
  3) Документы — связать с просмотром/скачиванием. — ВЫПОЛНЕНО

ВАЖНО: В схеме фонда предусмотрены `bankDetails` (вкл. ИНН/КПП). Если на странице «Реквизиты» требуется другой набор — синхронизировать поля или дополнить схему/данные.

---

### Этап 12: Контакты `/contacts`
- Источник данных: `GET /settings` или частично `GET /settings/contact` (если требуется дробно): `address`, `contactEmail`, `contactPhone`, `workingHours`.
- Задачи:
  1) Заменить статические данные на значения из настроек.
  2) Форму обратной связи пока оставить статической (без отправки) или настроить отдельный эндпоинт почтовой отправки (при его появлении).

ВАЖНО: Убедиться, что на бэке заполнены site settings (админка: «Настройки сайта»). При необходимости — обновить через админку.

---

### Этап 13: Раздел «Об ассоциации» `/about`, `/about/history`, `/about/structure`, `/about/leadership`
- Рекомендуем перевод этой группы страниц на CMS-страницы по slug:
  - `GET /pages/slug/about`, `about/history`, `about/structure`, `about/leadership` — поле `content` (HTML) + `title`, SEO-поля.
- Задачи:
  1) Для каждой страницы добавить загрузку `Page` по соответствующему `slug` и отрисовать HTML-контент в текущем шаблоне.
  2) Если отдельных страниц ещё нет — создать в админке (slug, заголовок, контент, статус `published`).

ВАЖНО: `GET /pages` и `GET /pages/:id` — только под JWT (админ). Публичный фронт должен использовать только `GET /pages/slug/:slug` и `GET /pages/slugs`.

---

### Этап 14: Статические страницы `/terms`, `/privacy`, `/requisites`, `/control`, `/labor-activity`, `/accreditation`, `/professional-development`
- Аналогично Этапу 13 через CMS-страницы:
  - `GET /pages/slug/terms`, `privacy`, `requisites`, `control`, `labor-activity`, `accreditation`, `professional-development`.
- Задачи:
  1) Создать/заполнить страницы в админке с указанными slug, перенести текущий текст в `content`.
  2) На фронте заменить статический контент на рендер HTML из API.

ВАЖНО: Включить индекс на уникальность главной страницы в рамках шаблона уже реализовано (`isCategoryMain` + уникальность) — использовать при необходимости главных страниц разделов.

---

### Этап 15: Хлебные крошки и SEO
- Источники данных SEO: поля `seoTitle`, `seoDescription`, `seoKeywords` у сущностей (News, Event, Page) + глобальные из `GET /settings` (seoSettings.default*).
- Задачи:
  1) В `Layout` подставлять заголовки/описания из сущностей; если нет — fallback на `settings`.
  2) Для хлебных крошек использовать маршрутную структуру + заголовки страниц из сущностей.

---

### Этап 16: Документация/типы и проверка совместимости
- Привести фронт-типы к бэкенд-сущностям:
  - News: автор может быть строкой (имя) или объект — нормализовать к строке.
  - Event: `agenda` — массив с `id/time/title/...` — 1:1 с бэком.
  - Document: использовать `id`, `title`, `description`, `category`, `fileUrl`, `fileSize`, `fileType`, `uploadedAt`, `version`, `isPublic` (для фильтрации на фронте можно игнорировать непубличные в публичных разделах).
  - ArbitraryManager: даты → строки; вложенные структуры (страхование, взносы) сводить к читаемым строкам для текущего UI.
- Проверить пограничные состояния: пустые списки, ошибки сети, таймауты — добавить заглушки/сообщения.

---

### Этап 17: Тестирование и приёмка
- Сценарии по страницам: загрузка без ошибок, корректные фильтры и пагинация, корректный рендер HTML-страниц (Pages), предпросмотр/скачивание документов (только публичные), регистрация на событие.
- Убедиться, что админ-панель способна создавать/редактировать контент, который корректно отображается на публичном сайте.

---

## Дополнительные «ВАЖНО» по бэку/админке/БД
- ВАЖНО: CORS — добавить домен фронта. — ВЫПОЛНЕНО (добавлены http://localhost:3000 и http://localhost:3002; поддержка CORS_ORIGIN через список)
- ВАЖНО: Сидинг справочников: `NewsCategory` (slugs), `EventType` (slugs), базовые `Page` со slug, `CompensationFund` запись (amount, bankDetails).
- ВАЖНО: Раздача статических файлов из `uploads/documents` (preview/download), корректные абсолютные URL.
- ВАЖНО: Эндпоинт `GET /pages/slug/:slug` уже публичный — использовать только его, не `GET /pages`.
- ВАЖНО: Для контактов/реквизитов — данные либо в `Settings`, либо в `CompensationFund.bankDetails`. Выбрать единый источник и синхронизировать контент.

---

## Краткая сводка эндпоинтов (публичные)
- Новости: `GET /news`, `GET /news/public`, `GET /news/latest`, `GET /news/featured`, `GET /news/search?q=`, `GET /news/category/:category`, `GET /news/categories`, `GET /news/:id`.
- Мероприятия: `GET /events`, `GET /events/upcoming`, `GET /events/featured`, `GET /events/types`, `GET /events/:id`, `POST /events/:id/register`.
- Документы: `GET /documents`, `GET /documents/public`, `GET /documents/categories`, `GET /documents/:id`, `GET /documents/:id/preview`, `GET /documents/:id/download`.
- Реестр: `GET /registry`, `GET /registry/statistics`, `GET /registry/inn/:inn`, `GET /registry/number/:registryNumber`, `GET /registry/:id`, `GET /registry/export/*`.
- Компенсационный фонд: `GET /compensation-fund`, `GET /compensation-fund/statistics`, `GET /compensation-fund/recent`, `GET /compensation-fund/history`.
- Настройки: `GET /settings`, `GET /settings/theme`, `GET /settings/seo`, `GET /settings/contact`.
- Страницы (CMS): `GET /pages/slugs`, `GET /pages/slug/:slug`.



# Руководство по отладке админ-панели

## Проблемы и решения

### 1. Ошибки 404 при загрузке данных

**Проблема**: `Request failed with status code 404` при загрузке документов и мероприятий.

**Причина**: API сервер (порт 3001) не запущен.

**Решение**: 
- Запустите бэкенд сервер: `cd sro-backend && npm run start:dev`
- Или используйте моковые данные (уже настроено)

### 2. Белый экран при перезагрузке страницы

**Проблема**: После перезагрузки страницы появляется белый экран и требуется повторный вход.

**Причина**: Состояние аутентификации не сохранялось в localStorage.

**Решение**: Исправлено в AuthContext - теперь пользователь сохраняется в localStorage.

### 3. Не загружаются тестовые страницы

**Проблема**: Страницы документов и мероприятий показывают ошибки загрузки.

**Причина**: API недоступен, но fallback на моковые данные не работал корректно.

**Решение**: Улучшена обработка ошибок API и добавлен fallback на моковые данные.

## Настройка окружения

### 1. Создайте .env.local файл

```bash
cp env.example .env.local
```

### 2. Настройки в .env.local

```env
# API Configuration
NEXT_PUBLIC_API_URL=http://localhost:3001/api

# App Configuration
NEXT_PUBLIC_APP_NAME="Админ панель СРО"
NEXT_PUBLIC_APP_DESCRIPTION="Система управления контентом для сайта СРО арбитражных управляющих"

# Development
NODE_ENV=development

# Mock API mode (when backend is not available)
NEXT_PUBLIC_USE_MOCK_DATA=true
```

## Запуск приложения

### Режим с API (рекомендуется)

1. Запустите бэкенд:
```bash
cd sro-backend
npm run start:dev
```

2. Запустите фронтенд:
```bash
cd admin-panel
npm run dev
```

### Режим с моковыми данными

1. Запустите только фронтенд:
```bash
cd admin-panel
npm run dev
```

Приложение автоматически переключится на моковые данные, если API недоступен.

## Тестовые данные для входа

- **Email**: admin@sro-au.ru
- **Пароль**: Admin123!

## Отладка

### Проверка состояния аутентификации

Откройте DevTools → Application → Local Storage и проверьте:
- `admin_token` - токен аутентификации
- `admin_refresh_token` - токен обновления
- `admin_user` - данные пользователя

### Проверка API запросов

Откройте DevTools → Network и проверьте:
- Запросы к `/api/*` должны возвращать 200 или 503 (если API недоступен)
- При 503 ошибке приложение должно переключиться на моковые данные

### Логи в консоли

- `API server not available, using mock data` - API недоступен, используются моковые данные
- `Using mock data for documents/events` - загружаются моковые данные
- `API unavailable, using mock user for auth` - используется моковый пользователь

## Известные ограничения

1. **Файлы**: Загрузка и скачивание файлов работает только с реальным API
2. **Сохранение**: Изменения в моковом режиме не сохраняются между перезагрузками
3. **Реальные данные**: Для работы с реальными данными необходимо запустить бэкенд

## Структура моковых данных

- **Документы**: `src/data/mockData.ts` - `mockDocuments`
- **Мероприятия**: `src/data/mockData.ts` - `mockEvents`
- **Пользователи**: `src/data/mockData.ts` - `mockUsers`
- **Категории**: `src/data/mockData.ts` - `mockDocumentCategories`, `mockEventTypes`
